name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  code-review:
    name: GitHub Copilot Code Review
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ¤– Run code review
        run: |
          echo "ğŸ” Code review will be performed by GitHub Copilot"
          echo "Please enable GitHub Copilot Code Review in repository settings"
          echo "Settings â†’ Code review â†’ Enable AI-powered code review"
      
      - name: ğŸ“‹ Review checklist
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const checklist = `
            ## ğŸ” Code Review Checklist
            
            Please verify the following before merging:
            
            ### Backend Agent âœ…
            - [ ] Minimal API patterns followed
            - [ ] EF Core configurations are correct
            - [ ] Async/await used throughout
            - [ ] XML documentation added
            - [ ] No business logic in Program.cs
            
            ### Security Agent ğŸ”
            - [ ] No hardcoded secrets
            - [ ] Authorization policies applied
            - [ ] JWT validation configured
            - [ ] HTTPS enforced
            
            ### Mobile Agent ğŸ“±
            - [ ] MVVM pattern followed
            - [ ] Dependency injection used
            - [ ] Loading states handled
            - [ ] Error messages user-friendly
            
            ### QA Agent ğŸ§ª
            - [ ] Tests added for new code
            - [ ] Code coverage > 80%
            - [ ] No code duplication
            - [ ] Edge cases tested
            
            ### DevOps Agent ğŸ³
            - [ ] Docker build succeeds
            - [ ] Environment variables documented
            - [ ] Health checks implemented
            - [ ] Security scan passed
            `;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: checklist
            });
